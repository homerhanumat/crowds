```{r}
## teams ui ----
fluidRow(
  column(
    width = 3,
    wellPanel(
      numericInput(
        inputId = "teams_expert_size", label = "Expert Team Size",
        min = 1, value = 9, step = 1
      ),
      numericInput(
        inputId = "teams_random_size", label = "Random Team Size",
        min = 1, value = 9, step = 1
      )
    )
  ),
  column(
    width = 6,
    wellPanel(
      sliderInput(
        inputId = "teams_move_limit",
        label = "Maximum Heuristic",
        value = 12,
        min = 1, max = 36,
        step = 1
      ),
      sliderInput(
        inputId = "teams_sf_range",
        label = "Smoothing-Factor Range",
        value = c(1, 20),
        min = 1, max = 20,
        step = 1
      )
    )
  ),
  column(
    width = 3,
    wellPanel(
      numericInput(
        inputId = "teams_sims",
        label = HTML("Number of<br>Simulations<br>(max 10000)"),
        value = 1000,
        min = 1,
        max = 10000
      ),
      actionButton(
        inputId = "teams_simulate",
        label = "Simulate"
      )
    )
  )
)

hidden(
  div(
    id = "teams_outputs",
    fluidRow(
      plotOutput("teams_plot")
    )
  )
)


## teams reactive values ----

rv_teams <- reactiveValues(
  simulations = NULL,
  results = NULL
)

## teams observers ----

observeEvent(input$teams_simulate, {
  show("teams_outputs")
  lst <- get_bounded_all(
    bound = input$teams_move_limit,
    lst = results_3_36_200_1to20_3030
  )
  lower <- isolate(input$teams_sf_range[1])
  upper <- isolate(input$teams_sf_range[2])
  rv_teams$results <- withProgress(
    message = "Simulating ...",
    min = lower, max = upper,
    comparison(
      sims = input$teams_sims,
      seed = NULL,
      expert_size = input$teams_expert_size,
      expert_limit = input$teams_expert_size,
      random_size = input$teams_random_size,
      set = lst
    )
  )
})



## teams outputs ----
output$teams_plot <- renderPlot({
  if (!is.null(rv_teams$results)) {
    lower <- isolate(input$teams_sf_range[1])
    upper <- isolate(input$teams_sf_range[2])
    sims <- isolate(input$teams_sims)
    ggplot(rv_teams$results, aes(x = factor, y = mean_diff)) +
      geom_ribbon(aes(
        ymin = mean_diff - 2 * sd_diff / sqrt(sims),
        ymax = mean_diff + 2 * sd_diff / sqrt(sims)
      ),
      fill = "grey70", alpha = 0.5
      ) +
      geom_line(aes(y = mean_diff)) +
      geom_hline(yintercept = 0) +
      scale_x_continuous(breaks = lower:upper) +
      labs(
        x = "smoothing factor",
        y = "mean of differences (experts - randoms)",
        title = "Mean Difference in Score (Expert - Random) vs. Smoothing-Factor"
      )
  }
})
```

